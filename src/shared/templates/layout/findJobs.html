<div class="find-jobs-menu">
	<div class="menu-row row">
		<div class="col-md-1 col-sm-1 col-lg-1"></div>
		<div class="col-md-10 col-sm-10 col-lg-10 row">
			<div class="col-sm-12 col-md-6 row">
				<div class="col-md-3 col-sm-3">
					<span class="small-span bold-span yellow-span">
						CITY
					</span>
					<select class="menu-select" data-ng-model="jobCitySearch" data-ng-options="city as city.name for city in cities">
					</select>
				</div>
				<div class="col-md-2 col-sm-2">
					<span class="small-span bold-span yellow-span">
						DISTANCE
					</span>
					<input class="menu-input" data-ng-model="jobDistanceSearch"
					data-ng-keyup="search($event)"
					placeholder="search by distance...">
				</div>    
				<div class="col-md-1 col-sm-1">
				</div>  
				<div class="col-md-6 col-sm-6">
					<span class="small-span bold-span yellow-span">
						CATEGORY
					</span>
					<select ng-change="attachSubcategories2(selectedCategory);" class="menu-select" data-ng-model="selectedCategory" data-ng-options="cat as cat.name for cat in categories">
					</select>
				</div>
			</div>    
			<div class="col-sm-6">
			</div>
			<div class="col-sm-6 col-md-6 row">
				<div class="col-md-6 col-sm-12">
					<span class="small-span bold-span yellow-span">
						SUBCATEGORY
					</span>
					<select class="menu-select" data-ng-model="selectedSubcategory" data-ng-options="subcat as subcat.name for subcat in subcategories" type="text" placeholder="subcategory">
					</select>
				</div>
				<div class="col-md-6 col-sm-12">
					<span class="small-span bold-span yellow-span">
						SEARCH
					</span>
					<input class="menu-input" type="text" placeholder="serach">
				</div>
			</div>    
		</div>
		<div class="col-md-1 col-sm-1 col-lg-1"></div>
	</div>
	<div class="menu-row row">
		<div class="col-md-1 col-sm-1">
		</div>
		<div class="col-md-10 col-sm-10 row">
			<div class="col-md-6 ">
			</div>
			<div class="col-md-6 row col-sm-12">
				<div ng-class="{graydiv : selectedCriteria != 'CALENDAR'}" class="text-center white-div col-md-3 col-sm-3" ng-click="selectedCriteria='CALENDAR'">
					CALENDAR
				</div>
				<div class="col-md-1 col-sm-1">
				</div>
				<div ng-class="{graydiv : selectedCriteria != 'DATE'}" class="text-center white-div col-sm-4 col-md-4" ng-click="selectedCriteria='DATE'">
					DATE
				</div>
				<div class="col-md-1 col-sm-1">
				</div>
				<div ng-class="{graydiv : selectedCriteria != 'MAP'}" class="text-center white-div col-md-3 col-sm-3" ng-click="selectedCriteria='MAP'">
					MAP
				</div>
			</div>
		</div>
		<div class="col-md-1 col-sm-1">
		</div>
	</div>
</div>

<div class="col-md-2 col-sm-2 col-lg-2"></div>

<div class="col-md-8 col-sm-8 col-lg-8">
	<br>
	<p style="border-top: 1px dashed #ccc;"></p>
	<br>
	
	<div id="{{$index}}" data-ng-repeat="job in filteredJobs">
		<div class="row" style="clear:both;margin-top:10px">
			<div class="col-md-12 col-sm-12 col-lg-12">
				<table class="table helvetica-neue widget-content ">
				<tbody class="height: 30%">
				  <tr>
				    <td rowspan="4" colspan="2" class="borderless yellow-tblock" style="border-right: 3px solid white; width: 30%;">
				    	<div class="text-center"> 
				    		<img class="img-thumbnail" style="max-height: 50%; max-width: 50%" ng-src="img/cats/{{categoryPictures[job.category]}}"/>
								<p class="bold-span" style="height: 30%">
									{{job.category.toUpperCase()}} / {{job.subcategory.toUpperCase()}}
								</p>
				    	</div>
				    </td>
				  </tr>

				  <tr>
				    <td class="borderless yellow-tblock text-center bottom-2-dashed" colspan="4">
				    </td>

				    <td class="bottom-2-dashed borderless yellow-tblock">
				    	Nesto 1C
				    </td>

				    <td class="bottom-2-dashed borderless yellow-tblock">
				    	Nesto 1D
				    </td>

				    <td class="bottom-2-dashed borderless yellow-tblock">
				    	Nesto 1E
				    </td>

				    <td class="bottom-2-dashed borderless yellow-tblock bookmark-star">
				    	<img src="/img/bookmark_star.gif"/>
				    </td>
				  </tr>

				  <tr>
				    <td class="borderless yellow-tblock text-center" colspan="4">
				    	<span class="black-div white-span helvetica-neue bold-span padding-4x" cr-date="{{job.dateFrom}}">
				    	</span>
				    	<span class="peach-div bold-span helvetica-neue padding-4x" cr-date="{{job.dateTo}}">
				    	</span>
				    </td>

				    <td colspan="4" rowspan="2" class="borderless yellow-tblock left-2-dashed">
						<table class="table bidders-table table-striped helvetica-neue widget-content">
						<thead>
							<tr>
								<th>Username</th>
								<th>Name</th>
								<th>Surname</th>
								<th>Rating</th>
							</tr>
						</thead>
						<tbody>
						  <tr ng-repeat="bidder in job.bidders">
						  	<td>{{bidder.username}}</td>
						    <td>{{bidder.name}}</td>
						    <td>{{bidder.surname}}</td>
						    <td>{{bidder.rating.avgRate}}</td>
						  </tr>
						</tbody>
						</table>
				    </td>
				  </tr>
				  
				  <tr>
				    <td class="borderless yellow-tblock text-center" colspan="4">
				    	<i ng-click="showMap(job, $index)" class="fa fa-map-marker map-marker-3x fa-3x"></i>
				    	<span class="bold-span">{{job.address.city}}</span>
				    </td>
				  </tr>
				</tbody>
				</table>
			</div>
		</div>

		<div id="gmaps-div-{{$index}}" style="height: 250px; display: none" class="peach-div row">
		</div>

		<div id="pics-div-{{$index}}" style="height: 250px; display: none" class="peach-div row">
			<lightbox images="job.jobPhotos"></lightbox>
		</div>
		
		<div class="job-buttons peach-div row">
			<a ui-sref="userProfile" class="job-button col-md-2 col-sm-2 hover-glow-white text-center">
				<i class="fa fa-user fa-2x"></i>
				<span class="small-span">
					client profile
				</span>
			</a>
			<div class="col-md-10 col-sm-10 row">
				<div class="job-button col-md-4 col-sm-4 hover-glow-white text-center" ng-click="deleteJob($index)">
					<i class="fa fa-envelope fa-2x"></i>
					<span class="small-span">
						send message
					</span>
				</div>
				<div class="col-md-8 col-sm-8">
					<div class="job-button col-md-6 col-sm-6 hover-glow-white text-center">
						<i class="fa fa-mail-forward fa-2x"></i>
						<span class="small-span">
							forward job
						</span>
					</div>
					<div class="job-button col-md-6 col-sm-6 hover-glow-white text-center">
						<i ng-click="showInfo(job, $index)" class="fa fa-info fa-2x"></i>
						<span class="small-span">
							info
						</span>
					</div>
				</div>
			</div>
		</div>

	</div>

<!-- 	<div class="clearfix"></div>
	<pagination class="pagination-sm" boundary-links="true" max-size="3" items-per-page="sizePerPage" total-items="user.createdJobs.length - 1" on-select-page="pageSelected" page="currentPage" rotate="false"></pagination>
	<div class="clearfix"></div>
 -->
</div>
<div class="col-md-2 col-sm-2 col-lg-2"></div>

<!--  <div class="widget wcyan">
    <div data-cc-widget-header title="Find a job"
    allow-collapse="true">
		
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="widget-content text-center text-info widget-ul-list">
                <input class="input-medium search-query"
                       data-ng-model="jobCitySearch"
                       data-ng-keyup="search($event)"
                       placeholder="search by city...">
               <input class="input-medium search-query"
                       data-ng-model="jobDistanceSearch"
                       data-ng-keyup="search($event)"
                       placeholder="search by distance...">
               <input class="input-medium search-query"
                       data-ng-model="jobCategorySearch"
                       data-ng-keyup="search($event)"
                       placeholder="search by category...">
               <input class="input-medium search-query"
                       data-ng-model="jobSubcategorySearch"
                       data-ng-keyup="search($event)"
                       placeholder="search by subcategory...">
            </div>
        </div>
        <div class="col-md-6">
        </div>
    </div>
</div> -->
<!-- <div class="clearfix">
</div>
<pagination class="pagination-sm" boundary-links="true" max-size="3" items-per-page="sizePerPage" on-select-page="allJobsPageSelected" page="allJobsCurrentPage" total-items="allJobsTotal" rotate="false">
</pagination>
<div class="clearfix">
</div> -->

<script>

var $holders = $("span[id^='holder'");

var tests = {
      filereader: typeof FileReader != 'undefined',
      dnd: 'draggable' in document.createElement('span'),
      formdata: !!window.FormData,
      progress: "upload" in new XMLHttpRequest
    },
    support = {
      filereader: document.getElementById('filereader'),
      formdata: document.getElementById('formdata'),
      progress: document.getElementById('progress')
    },
    acceptedTypes = {
      'image/png': true,
      'image/jpeg': true,
      'image/jpg': true
    },
    progress = document.getElementById('uploadprogress'),
    fileupload = document.getElementById("job-photo-upload-form");

function previewfile(holder, file, index) {
  if (tests.filereader === true && acceptedTypes[file.type] === true) {
    var reader = new FileReader();
    reader.onload = function (event) {
      var image = new Image();
      var bla = event.target.result;
      if(((bla.length - 814) / 1.37) > 128*1024) {
        alert("Images greater than 128 kilobytes are not allowed");
        return;
      }
      image.src = event.target.result;
      $(holder).empty();
      holder.appendChild(image);
      var scope = angular.element($(holder)).scope();
      scope.$apply(function(){
          scope.currentJob.storeJobPhoto(image, index);
      });
    };
    reader.readAsDataURL(file);
  }  else {
    holder.innerHTML += '<p>Uploaded ' + file.name + ' ' + (file.size ? (file.size/1024|0) + 'K' : '');
  }
}

function readfiles(holder, files, index) {
    var formData = tests.formdata ? new FormData() : null;
    for (var i = 0; i < files.length; i++) {
      if (tests.formdata) {
        formData.append('file', files[i]);
      }
      previewfile(holder, files[i], index);
    }
}

$fileupload = $(fileupload);
$fileupload.find(".hidden").removeClass("hidden");
if (tests.dnd) { 
  var i = 0;
  $holders.each(function(key, holder) {

    holder.ondragover = function () { this.className = 'hover job-photo-holder'; return false; }.bind(this);
    holder.ondragend = function () { this.className = 'job-photo-holder'; return false; }.bind(this);
    
    holder.ondrop = (function(holder, index) {
        return (function (e) {
          this.className = 'job-photo-holder';
          e.preventDefault();
          readfiles(this, e.dataTransfer.files, index);
        }).bind(holder)
    })(holder, i);

    $input = $(holder).find('input');
    $input.change((function (holder, index) {
        console.debug("oho");
        return (function() {
          console.debug("cao")
          readfiles(holder, this.files, index);
        });
      })(holder, i)
    );
    ++i;
  });

  // $fileupload = $(fileupload);
  // $fileupload.find(".hidden").removeClass("hidden");
  // $fileupload.find(".job-photo-holder").each(function(key, value) {

  // });
}

</script>